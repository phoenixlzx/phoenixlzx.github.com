<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Directshare - 一个简单的HTTP直链文件分享工具 | Phoenix&#39;s island</title>
    <meta name="author" content="Phoenix Nemo">
    
    <meta name="description" content="Phoenix&#39;s Blog">
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="Directshare - 一个简单的HTTP直链文件分享工具"/>
    <meta property="og:site_name" content="Phoenix&#39;s island"/>

    
    <meta property="og:image" content="undefined"/>
    

    <link href="/favicon.png" rel="icon">
    <link rel="alternate" href="/atom.xml" title="Phoenix&#39;s island" type="application/atom+xml">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
    <link rel="stylesheet" href="/css/font-awesome.css"/>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Phoenix&#39;s island</a></h1>
  <h2><a href="/">Sun will shine on the horizon.</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about">About</a></li>
    
      <li><a href="/links">Links</a></li>
    
      <li><a href="/atom.xml">RSS</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
    <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"></div>
    <div class="next"></div>
  </div>
</div>
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-02-06T11:14:34.000Z"><a href="/2014/02/06/directshare-a-simple-file-sharing-using-direct-http-links/">2014-02-06</a></time>
      
      
  
    <h1 class="title">Directshare - 一个简单的HTTP直链文件分享工具</h1>
  

    </header>
    <div class="entry">
      
        <p>嘛… 最近真心补番补多了智商降得有点厉害.. 直到我发现自己已经看不懂别人的 js 代码，却还会手贱点开 bilibili 之后才 <a href="https://plus.google.com/107142103119739092775/posts/M2LA33yfdRG" target="_blank" rel="external"> 立下军令状</a>，再不开新坑再不敲代码就敲不出来啦！</p>
<p>一直很纠结再写点啥。之前财务管理系统的坑估计要弃，因为实在一个人填不完…然后 NAE 一直没计划好，估计这个坑会更巨。之前 luke 酱说发现了一个不错的东方音乐站，想要个桌面端。咱之前有试着学 Qt 但是一直没有方便的文档而且.. 终归是咱能力不行吧，Qt 估计是一时半会搞不定了。写桌面端的话，似乎只有 node-webkit 了.. 然后看了一下午的文档只有一个感觉——我要死了。</p>
<p><del>Intel 开发的东西和红帽一样蛋疼</del></p>
<p>桌面端什么的…. 所以就放着吧… 随便搞个东西练练手算了。想想看还没有练习过文件上传 <del>真丢人啊都不会写文件上传</del> 于是来写一个上传文件并分享的东西好了 w</p>
<p>于是老样子.. <code>express -e</code> 新建一个项目模板，初始化 git 仓库… 诶似乎有什么东西不对？</p>
<p><code>express.bodyParser()</code> 没了…</p>
<p>先不管这些，基本的路由和功能堆起来，打印出结果来看看能不能正确获取文件信息。然后… 当然失败了。</p>
<p>没有 <code>bodyParser</code> 之后，带有文件上传的表单无法被处理了，<code>req.files</code> 是 <code>undefined</code>，<code>req.body</code> 里也是空的..</p>
<p>一阵 Google 之后表示，泥煤的 express 3.4.x 又改了… <code>bodyParser</code> 已经被 <a href="https://groups.google.com/forum/#!topic/express-js/iP2VyhkypHo" target="_blank" rel="external"> 弃用 </a>，原因是存在<a href="http://andrewkelley.me/post/do-not-use-bodyparser-with-express-js.html" target="_blank" rel="external"> 可能占满磁盘的漏洞</a>。目前推荐的方式是直接使用 <code>multiparty</code>。于是又去翻这货的文档，表示要蛋疼许多… 纠结了一会觉得还是先用回 3.3.4 之后慢慢折腾下 multiparty。</p>
<p>Directshare 使用 HTTP 直链文件，看起来似乎有点危险，不过毕竟可以拿来做图床、临时的文件共享或者在没有 FTP/SSH 的情况下把文件上传到服务器什么的.. 最重要的是，<del>我只是想练练手而已搞那么复杂干嘛..</del></p>
<p>基本思路：整个程序分为负责接收文件的 master 和负责分发文件的 cluster。客户端使用浏览器 POST 方法上传文件 =&gt; master 得到文件后计算 SHA256 并把文件从临时目录移动到保存文件的目录，文件名是 SHA256 值，不带有后缀。接下来通知所有 cluster 来拖。这里要有一个验证，暂且用 POST accesskey 之类的东西来做好了。因为似乎没找到啥能通过 http 同步的 node 包，所以简单的双向 POST 数据基本上也没问题。本来想在 cluster 接收到文件后再计算一次 hash 值.. 不过这个后面再说。通知所有 cluster 用了一个 forEach，虽然是阻塞的方法不过发几个 post 请求应该是相当快的。接下来把从 cluster 下载文件的地址返回给客户端浏览器。这个时候 cluster 应该已经收到 post 请求，过来拖文件了。</p>
<p>文件 <code>master.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Module dependencies.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'./config.js'</span>);</div><div class="line"><span class="keyword">var</span> crypto = <span class="built_in">require</span>(<span class="string">'crypto'</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"></div><div class="line"><span class="comment">// all environments</span></div><div class="line">app.set(<span class="string">'port'</span>, config.port || <span class="number">3000</span>);</div><div class="line">app.set(<span class="string">'views'</span>, path.join(__dirname, <span class="string">'views'</span>));</div><div class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'ejs'</span>);</div><div class="line">app.use(express.favicon());</div><div class="line">app.use(express.logger(<span class="string">'dev'</span>));</div><div class="line">app.use(express.json());</div><div class="line">app.use(express.bodyParser({</div><div class="line">    keepExtensions: <span class="literal">false</span>,</div><div class="line">    uploadDir: <span class="string">"tmpdata"</span></div><div class="line">}));</div><div class="line">app.use(express.methodOverride());</div><div class="line"><span class="comment">// app.use(app.router);</span></div><div class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));</div><div class="line"></div><div class="line"><span class="comment">// development only</span></div><div class="line"><span class="keyword">if</span> (<span class="string">'development'</span> == app.get(<span class="string">'env'</span>)) {</div><div class="line">  app.use(express.errorHandler());</div><div class="line">}</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> {</span></div><div class="line">    res.render(<span class="string">'index'</span>, {</div><div class="line">        siteName: config.siteName</div><div class="line">    });</div><div class="line">});</div><div class="line"></div><div class="line">app.post(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> {</span></div><div class="line">    <span class="comment">// console.log(req.files.uploadfile);</span></div><div class="line"></div><div class="line">    <span class="comment">// hash file with sha256</span></div><div class="line">    <span class="keyword">var</span> sha256sum = crypto.createHash(<span class="string">'sha256'</span>);</div><div class="line">    <span class="keyword">var</span> filehash = fs.ReadStream(req.files.uploadfile.path);</div><div class="line">    filehash.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span></div><div class="line">        sha256sum.update(d);</div><div class="line">    });</div><div class="line">    filehash.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span></div><div class="line">        <span class="keyword">var</span> d = sha256sum.digest(<span class="string">'hex'</span>);</div><div class="line">        console.log(d + <span class="string">''</span> + req.files.uploadfile.name);</div><div class="line">        <span class="comment">// move file to storage location</span></div><div class="line">        fs.rename(req.files.uploadfile.path, <span class="string">'files/'</span> + d, <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span></div><div class="line">            <span class="comment">// notify clusters to fetch file</span></div><div class="line">            config.clusters.forEach(<span class="function"><span class="keyword">function</span><span class="params">(cluster)</span> {</span></div><div class="line">                <span class="keyword">var</span> post_data = querystring.stringify({</div><div class="line">                    clusterkey: config.clusterkey,</div><div class="line">                    filename: req.files.uploadfile.name,</div><div class="line">                    filehash: d</div><div class="line">                });</div><div class="line"></div><div class="line">                <span class="keyword">var</span> post_options = {</div><div class="line">                    hostname: cluster,</div><div class="line">                    port: config.clustersport,</div><div class="line">                    path: <span class="string">'/syncfile'</span>,</div><div class="line">                    method: <span class="string">'POST'</span>,</div><div class="line">                    headers: {</div><div class="line">                        <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</div><div class="line">                        <span class="string">'Content-Length'</span>: post_data.length</div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// Set up the request</span></div><div class="line">                console.log(<span class="string">'syncing with '</span> + cluster);</div><div class="line">                <span class="keyword">var</span> post_req = http.request(post_options);</div><div class="line"></div><div class="line">                <span class="comment">// post the data</span></div><div class="line">                post_req.write(post_data);</div><div class="line">                post_req.end();</div><div class="line">            });</div><div class="line">            <span class="comment">// return client with download path</span></div><div class="line">            res.send(<span class="number">200</span>, config.clusterurl + d);</div><div class="line">        });</div><div class="line">    });</div><div class="line">});</div><div class="line"></div><div class="line">app.post(<span class="string">'/syncfile'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> {</span></div><div class="line">    <span class="keyword">if</span> (req.body.clusterkey != config.clusterkey) {</div><div class="line">        <span class="keyword">return</span> res.send(<span class="number">401</span>);</div><div class="line">    } <span class="keyword">else</span> {</div><div class="line">        res.sendfile(<span class="string">'files/'</span> + req.body.filehash);</div><div class="line">    }</div><div class="line">});</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// handle 404</span></div><div class="line">app.use(<span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> {</span></div><div class="line">    res.send(<span class="number">404</span>, <span class="string">'My files gone?! :-O'</span>);</div><div class="line">});</div><div class="line"></div><div class="line">http.createServer(app).listen(app.get(<span class="string">'port'</span>), <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span></div><div class="line">  console.log(<span class="string">'Express server listening on port '</span> + app.get(<span class="string">'port'</span>));</div><div class="line">});</div></pre></td></tr></table></figure>

<p>然后是 <code>cluster.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Module dependencies.</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</div><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'./config.js'</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> app = express();</div><div class="line"></div><div class="line"><span class="comment">// all environments</span></div><div class="line">app.set(<span class="string">'port'</span>, config.port || <span class="number">3000</span>);</div><div class="line">app.use(express.favicon());app.use(express.logger(<span class="string">'dev'</span>));</div><div class="line">app.use(express.json());</div><div class="line">app.use(express.methodOverride());</div><div class="line">app.use(express.bodyParser());</div><div class="line">app.use(app.router);</div><div class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));</div><div class="line"></div><div class="line"><span class="comment">// development only</span></div><div class="line"><span class="keyword">if</span> (<span class="string">'development'</span> == app.get(<span class="string">'env'</span>)) {</div><div class="line">  app.use(express.errorHandler());</div><div class="line">}</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> {</span></div><div class="line">    res.send(<span class="number">400</span>, <span class="string">'Bad request'</span>);</div><div class="line">});</div><div class="line"></div><div class="line">app.get(<span class="string">'/:hash'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> {</span></div><div class="line">    fs.readFile(<span class="string">'files/'</span> + req.params.hash + <span class="string">'.json'</span>, <span class="string">'utf8'</span>, <span class="function"><span class="keyword">function</span><span class="params">(err, filedata)</span> {</span></div><div class="line">        <span class="keyword">if</span> (err) {</div><div class="line">            <span class="keyword">if</span> (err.code === <span class="string">'ENOENT'</span>) {</div><div class="line">                res.send(<span class="number">404</span>, <span class="string">'File not found. :-('</span>);</div><div class="line">            } <span class="keyword">else</span> {</div><div class="line">                console.log(err);</div><div class="line">            }</div><div class="line">        } <span class="keyword">else</span> {</div><div class="line">            <span class="keyword">var</span> filedata = <span class="built_in">JSON</span>.parse(filedata);</div><div class="line">            res.download(<span class="string">'files/'</span> + req.params.hash, filedata.filename);</div><div class="line">        }</div><div class="line">    })</div><div class="line">});</div><div class="line"></div><div class="line">app.post(<span class="string">'/syncfile'</span>, <span class="function"><span class="keyword">function</span><span class="params">(req, res)</span> {</span></div><div class="line">    <span class="keyword">if</span> (req.body.clusterkey != config.clusterkey) {</div><div class="line">        <span class="keyword">return</span> res.send(<span class="number">401</span>);</div><div class="line">    } <span class="keyword">else</span> {</div><div class="line">        res.send(<span class="number">200</span>);</div><div class="line">        <span class="keyword">var</span> post_data = querystring.stringify({</div><div class="line">            clusterkey: config.clusterkey,</div><div class="line">            filehash: req.body.filehash</div><div class="line">        });</div><div class="line"></div><div class="line">        <span class="keyword">var</span> post_options = {</div><div class="line">            hostname: config.master,</div><div class="line">            port: config.masterport,</div><div class="line">            path: <span class="string">'/syncfile'</span>,</div><div class="line">            method: <span class="string">'POST'</span>,</div><div class="line">            headers: {</div><div class="line">                <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</div><div class="line">                <span class="string">'Content-Length'</span>: post_data.length</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="comment">// Set up the request</span></div><div class="line">        console.log(<span class="string">'Getting file with SHA256'</span> + req.body.filehash);</div><div class="line">        <span class="keyword">var</span> post_req = http.request(post_options, <span class="function"><span class="keyword">function</span><span class="params">(res)</span> {</span></div><div class="line">            <span class="keyword">var</span> file = fs.createWriteStream(<span class="string">'files/'</span> + req.body.filehash);</div><div class="line">            res.pipe(file);</div><div class="line">        });</div><div class="line"></div><div class="line">        <span class="comment">// post the data</span></div><div class="line">        post_req.write(post_data);</div><div class="line">        post_req.end();</div><div class="line"></div><div class="line">        fs.appendFile(<span class="string">'files/'</span> + req.body.filehash + <span class="string">'.json'</span>, <span class="built_in">JSON</span>.stringify({</div><div class="line">            <span class="string">"filename"</span>: req.body.filename</div><div class="line">        }), <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span></div><div class="line">            console.log(<span class="string">'Saved file'</span> + req.body.filename + <span class="string">'with hash'</span> + req.body.filehash);</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">});</div><div class="line"></div><div class="line">http.createServer(app).listen(app.get(<span class="string">'port'</span>), <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span></div><div class="line">  console.log(<span class="string">'Express server listening on port'</span> + app.get(<span class="string">'port'</span>));</div><div class="line">});</div></pre></td></tr></table></figure>

<p>这样程序应该就相当清晰了。在 cluster 端使用了 SHA256 值作为文件名的 json 作为文件信息存储，当前只保存了对应的文件名。至于重复文件啊什么的.. 暂时没想好怎么做，不过拿 sha256 做文件名本来就有这个功能的想法。本地测试完成，commit #<a href="https://github.com/phoenixlzx/directshare/commit/f6365cfcbd18536f226da1e4fe633ece665b6ec2" target="_blank" rel="external"><code>f6365cfcbd</code></a></p>
<p>当我发军令状的时候是昨晚 9 点，第一个可用版本提交是今天 2 点左右，5 个小时开新坑再填上… 不过这坑有点小所以好填… 所以 5 个小时不算什么了吧就… 嘛至少不用改名 BAKA 了～</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/Nodejs/">Node.js</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/Nodejs/">Node.js</a>, <a href="/tags/Practise/">Practise</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:blog.phoenixlzx.com">
  </form>
</div>

  <div class="widget tag">
    <h3 class="title">关于</h3>
    <div class="entry">
        <img src="/static/img/avatar/avatar.jpg" style="margin: auto; width: 100%;"/>
        <h4 style="text-align: center">Phoenix Nemo (phoenixlzx)</h4>
        <div style="margin: auto; text-align: center;">
            <a href="https://plus.google.com/107142103119739092775" target="_blank"><i class="fa fa-google-plus fa-2x"></i></a>&nbsp;&nbsp;
            <a href="https://twitter.com/phoenixlzx" target="_blank"><i class="fa fa-twitter fa-2x"></i></a>&nbsp;&nbsp;
            <a href="https://github.com/phoenixlzx" target="_blank"><i class="fa fa-github fa-2x"></i></a>&nbsp;&nbsp;
            <a class="fancybox" href="#emailme"><i class="fa fa-envelope-o fa-2x"></i></a>
        </div>
        <div style="display: none;">
            <div id="emailme">
                <p><strong>个人邮箱地址</strong></p>
                <br/>
                <code>echo 'aUBwaG9lbml4bHp4LmNvbQo='|base64 --decode</code>
            </div>
        </div>
    </div>
</div>


  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/Algorithm/">Algorithm</a><small>1</small></li>
  
    <li><a href="/categories/Database/">Database</a><small>1</small></li>
  
    <li><a href="/categories/Life/">Life</a><small>4</small></li>
  
    <li><a href="/categories/Linux/">Linux</a><small>2</small></li>
  
    <li><a href="/categories/Network/">Network</a><small>3</small></li>
  
    <li><a href="/categories/Nodejs/">Node.js</a><small>5</small></li>
  
    <li><a href="/categories/Notes/">Notes</a><small>8</small></li>
  
    <li><a href="/categories/Practise/">Practise</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Algorithm/" style="font-size: 10.00px;">Algorithm</a><a href="/tags/Anime/" style="font-size: 16.00px;">Anime</a><a href="/tags/Artwork/" style="font-size: 10.00px;">Artwork</a><a href="/tags/Configuration/" style="font-size: 12.00px;">Configuration</a><a href="/tags/DKMS/" style="font-size: 10.00px;">DKMS</a><a href="/tags/DNS/" style="font-size: 14.00px;">DNS</a><a href="/tags/FFmpeg/" style="font-size: 14.00px;">FFmpeg</a><a href="/tags/Fibonacci/" style="font-size: 10.00px;">Fibonacci</a><a href="/tags/Filesystem/" style="font-size: 10.00px;">Filesystem</a><a href="/tags/ImageMagick/" style="font-size: 10.00px;">ImageMagick</a><a href="/tags/KDE/" style="font-size: 10.00px;">KDE</a><a href="/tags/Kernel/" style="font-size: 10.00px;">Kernel</a><a href="/tags/Linux/" style="font-size: 14.00px;">Linux</a><a href="/tags/Minecraft/" style="font-size: 12.00px;">Minecraft</a><a href="/tags/MongoDB/" style="font-size: 10.00px;">MongoDB</a><a href="/tags/Multimedia/" style="font-size: 14.00px;">Multimedia</a><a href="/tags/MyPet/" style="font-size: 10.00px;">MyPet</a><a href="/tags/Network/" style="font-size: 14.00px;">Network</a><a href="/tags/Nodejs/" style="font-size: 20.00px;">Node.js</a><a href="/tags/Practise/" style="font-size: 10.00px;">Practise</a><a href="/tags/Script/" style="font-size: 10.00px;">Script</a><a href="/tags/Server/" style="font-size: 18.00px;">Server</a><a href="/tags/Ubuntu/" style="font-size: 14.00px;">Ubuntu</a><a href="/tags/VPN/" style="font-size: 10.00px;">VPN</a><a href="/tags/WordPress/" style="font-size: 10.00px;">WordPress</a><a href="/tags/iptables/" style="font-size: 12.00px;">iptables</a>
  </div>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2014/07/21/setup-openconnect-server-on-ubuntu/">在 Ubuntu 服务器上搭建 OpenConnect 服务器小记</a>
      </li>
    
      <li>
        <a href="/2014/05/24/iptables-rate-limiting-rules-to-block-dns-amplification-attack/">使用 iptables 过滤 DNS 放大攻击</a>
      </li>
    
      <li>
        <a href="/2014/05/19/for-loop-in-async-function-with-async-in-it/">在异步方法中使用 for 循环，以及循环中包含异步方法的几点坑</a>
      </li>
    
      <li>
        <a href="/2014/05/17/repo-arm-disk-rescue-and-resize/">修复 Arch Rollback Machine 磁盘占用</a>
      </li>
    
      <li>
        <a href="/2014/05/16/accelerate-apple-services-in-cn/">为国内用户加速 Apple 服务</a>
      </li>
    
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2014 Phoenix Nemo
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'phoenixhexo';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js?https';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>